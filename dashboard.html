<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Pet Wellness Hub</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Admin Dashboard</h1>
    <nav>
      <a href="index.html"><i class="fas fa-home"></i> Home</a>
      <a href="appointment.html"><i class="fas fa-calendar-check"></i> Book Appointment</a>
      <a href="dashboard.html"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
      <a href="history.html"><i class="fas fa-history"></i> History</a>
      <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </nav>
  </header>

  <main class="dashboard">
    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
      <div class="card fade-in" style="animation-delay: 0.1s;">
        <h3><i class="fas fa-calendar"></i> Total Appointments</h3>
        <p id="appointmentCount" style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">0</p>
      </div>
     
      <div class="card fade-in" style="animation-delay: 0.2s;">
        <h3><i class="fas fa-dog"></i> Most Common Pet</h3>
        <p id="commonPet" style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">-</p>
      </div>
     
      <div class="card fade-in" style="animation-delay: 0.3s;">
        <h3><i class="fas fa-stethoscope"></i> Popular Service</h3>
        <p id="popularService" style="font-size: 2.5rem; font-weight: bold; color: var(--primary);">-</p>
      </div>
    </div>

    <div class="layout" style="display: flex; gap: 2rem; flex-wrap: wrap;">
      <div class="card fade-in" style="flex: 1; min-width: 300px; animation-delay: 0.4s;">
        <h3><i class="fas fa-chart-line"></i> Appointments Trend</h3>
        <canvas id="appointmentsChart" style="width: 100%; height: 300px;"></canvas>
      </div>
     
      <div class="card fade-in" style="flex: 1; min-width: 300px; animation-delay: 0.5s;">
        <h3><i class="fas fa-chart-pie"></i> Services Distribution</h3>
        <canvas id="servicesChart" style="width: 100%; height: 300px;"></canvas>
      </div>
    </div>

    <div class="card fade-in" style="margin-top: 2rem; animation-delay: 0.6s;">
      <h3><i class="fas fa-clock"></i> Recent Bookings</h3>
      <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th>#</th>
              <th>Owner</th>
              <th>Pet</th>
              <th>Type</th>
              <th>Service</th>
              <th>Date</th>
              <th>Time</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="recentBookings">
            <tr><td colspan="8">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="logout" style="text-align: center; margin-top: 2rem;">
      <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </div>
  </main>

  <script>
    function logout() {
      localStorage.removeItem('adminLoggedIn');
      window.location.href = 'login.html';
    }

    // Load data from localStorage
    function loadDashboardData() {
      const stored = localStorage.getItem('appointments');
      let appointments = stored ? JSON.parse(stored) : [];
     
      // Update stats
      document.getElementById('appointmentCount').textContent = appointments.length;
     
      // Find most common pet type
      if (appointments.length > 0) {
        const petTypes = appointments.map(a => a.petType);
        const petTypeCounts = {};
        petTypes.forEach(type => {
          petTypeCounts[type] = (petTypeCounts[type] || 0) + 1;
        });
        const commonPet = Object.keys(petTypeCounts).reduce((a, b) =>
          petTypeCounts[a] > petTypeCounts[b] ? a : b);
        document.getElementById('commonPet').textContent = commonPet.charAt(0).toUpperCase() + commonPet.slice(1);
       
        // Find most popular service
        const services = appointments.map(a => a.service);
        const serviceCounts = {};
        services.forEach(service => {
          serviceCounts[service] = (serviceCounts[service] || 0) + 1;
        });
        const popularService = Object.keys(serviceCounts).reduce((a, b) =>
          serviceCounts[a] > serviceCounts[b] ? a : b);
        document.getElementById('popularService').textContent = popularService.charAt(0).toUpperCase() + popularService.slice(1);
      }
     
      // Update recent bookings table
      const tbody = document.getElementById('recentBookings');
      tbody.innerHTML = '';
     
      if (appointments.length === 0) {
        tbody.innerHTML = '<tr><td colspan="8">No bookings yet.</td></tr>';
      } else {
        appointments.slice(-10).reverse().forEach((a, i) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${i + 1}</td>
            <td>${a.owner}</td>
            <td>${a.pet}</td>
            <td>${a.petType}</td>
            <td>${a.service}</td>
            <td>${a.date}</td>
            <td>${a.time}</td>
            <td>
              <button onclick="editAppointment('${a.id}')" style="padding: 0.25rem 0.5rem; margin-right: 0.5rem;"><i class="fas fa-edit"></i></button>
              <button onclick="deleteAppointment('${a.id}')" style="padding: 0.25rem 0.5rem;"><i class="fas fa-trash"></i></button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }
     
      // Create charts
      createCharts(appointments);
    }
   
    function createCharts(appointments) {
      // Appointments trend (last 7 days)
      const dates = [];
      const counts = [];
      const today = new Date();
     
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(today.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        dates.push(dateStr);
       
        const count = appointments.filter(a => a.date === dateStr).length;
        counts.push(count);
      }
     
      const trendCtx = document.getElementById('appointmentsChart').getContext('2d');
      new Chart(trendCtx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [{
            label: 'Appointments',
            data: counts,
            backgroundColor: 'rgba(0, 168, 107, 0.2)',
            borderColor: 'rgba(0, 168, 107, 1)',
            borderWidth: 2,
            tension: 0.4
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
              precision: 0
            }
          }
        }
      });
     
      // Services distribution
      if (appointments.length > 0) {
        const services = {};
        appointments.forEach(a => {
          services[a.service] = (services[a.service] || 0) + 1;
        });
       
        const servicesCtx = document.getElementById('servicesChart').getContext('2d');
        new Chart(servicesCtx, {
          type: 'pie',
          data: {
            labels: Object.keys(services),
            datasets: [{
              data: Object.values(services),
              backgroundColor: [
                'rgba(0, 92, 60, 0.7)',
                'rgba(0, 168, 107, 0.7)',
                'rgba(46, 125, 50, 0.7)',
                'rgba(67, 160, 71, 0.7)',
                'rgba(102, 187, 106, 0.7)'
              ]
            }]
          },
          options: {
            responsive: true
          }
        });
      }
    }
   
    function editAppointment(id) {
      alert('Edit functionality would open a form to edit appointment ' + id);
    }
   
    function deleteAppointment(id) {
      if (confirm('Are you sure you want to delete this appointment?')) {
        let appointments = JSON.parse(localStorage.getItem('appointments'));
        appointments = appointments.filter(a => a.id != id);
        localStorage.setItem('appointments', JSON.stringify(appointments));
        loadDashboardData();
      }
    }
   
    // Check if admin is logged in
    if (!localStorage.getItem('adminLoggedIn')) {
      window.location.href = 'login.html';
    }
   
    // Load data when page loads
    window.addEventListener('load', loadDashboardData);
  </script>


<h2>Dashboard Overview</h2>
<ul>
    <li>Total Appointments: <strong id="totalAppointments">0</strong></li>
    <li>Popular Service: <strong id="popularService">N/A</strong></li>
    <li>Most Common Pet: <strong id="commonPet">N/A</strong></li>
</ul>

<h2>Appointment History</h2>
<table id="appointmentHistory" border="1" style="width:100%; border-collapse: collapse;">

</table>
<br>
<button onclick="exportToNote()">Export to Note</button>

<script>
function exportToNote() {
    var table = document.getElementById("appointmentHistory");
    var text = "";
    for (var i = 0; i < table.rows.length; i++) {
        var cells = table.rows[i].cells;
        for (var j = 0; j < cells.length; j++) {
            text += cells[j].innerText + "\t";
        }
        text += "\n";
    }

    var blob = new Blob([text], { type: "text/plain" });
    var link = document.createElement("a");
    link.download = "appointment_history.txt";
    link.href = window.URL.createObjectURL(blob);
    link.click();
}
</script>


<script>
document.addEventListener("DOMContentLoaded", function () {
    let appointments = JSON.parse(localStorage.getItem("appointments") || "[]");

    let table = document.getElementById("appointmentHistory");
    table.innerHTML = `
        <tr>
            <th>Date</th>
            <th>Time</th>
            <th>Pet Name</th>
            <th>Owner</th>
            <th>Reason</th>
        </tr>
    `;

    appointments.forEach(a => {
        let row = table.insertRow();
        row.insertCell().textContent = a.date || "";
        row.insertCell().textContent = a.time || "";
        row.insertCell().textContent = a.pet || "";
        row.insertCell().textContent = a.owner || "";
        row.insertCell().textContent = a.reason || "";
    });
});
</script>


</body>
</html>